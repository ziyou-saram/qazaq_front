# Qazaq CMS: Полный гайд по использованию и ролям

## 1. Назначение CMS

Qazaq CMS - внутренняя система для управления новостями и статьями с ролевым workflow.

Базовая схема состояний материала:

`draft` -> `in_review` -> `approved` -> `published`

Отдельная ветка:

`in_review` -> `needs_revision` -> (после правок) `in_review`

---

## 2. Доступ и авторизация

### 2.1 URL

- CMS (локально): `http://localhost:3001`
- Страница входа: `/login`
- Регистрация: `/signup`
- Главная CMS после входа: `/cms/dashboard`

### 2.2 Правила доступа

- Неавторизованный пользователь при входе в `/cms/*` автоматически перенаправляется на `/login`.
- Авторизованный пользователь при попытке открыть `/login` или `/signup` перенаправляется на `/cms/dashboard`.
- Роль `admin` нельзя выбрать при обычной регистрации (назначается отдельно).

---

## 3. Роли и зоны ответственности

### 3.1 `editor`

Отвечает за создание и доработку контента:

- создает материалы;
- редактирует черновики;
- отправляет материал на проверку;
- вносит правки после комментариев главного редактора.

### 3.2 `chief_editor`

Отвечает за редакторский контроль качества:

- просматривает очередь материалов на проверке;
- принимает решение:
  - одобрить материал;
  - отправить на доработку с комментарием.

### 3.3 `publishing_editor`

Отвечает за публикацию:

- видит одобренные материалы;
- публикует материал;
- снимает материал с публикации при необходимости.

### 3.4 `admin`

Отвечает за управление системой:

- управление пользователями (роли, активность);
- просмотр всех материалов;
- удаление материалов.

### 3.5 `moderator`

Роль предусмотрена в системе, но полноценный отдельный UI-процесс модерации в текущей версии ограничен.

---

## 4. Полный рабочий процесс (end-to-end)

1. Editor создает материал как `draft`.
2. Editor отправляет материал на проверку (`in_review`).
3. Chief editor:
   - либо одобряет (`approved`);
   - либо возвращает на доработку (`needs_revision`) с комментарием.
4. Если материал вернули, editor вносит правки и отправляет повторно.
5. Publishing editor публикует материал (`published`).
6. При необходимости publishing editor снимает материал с публикации (возврат в `approved`).

---

## 5. Инструкции по ролям (пошагово)

## 5.1 Editor: создание и отправка материала

1. Перейдите в раздел `Мои материалы` (`/cms/editor`).
2. Нажмите `Создать`.
3. Заполните форму:
   - `Заголовок`;
   - `Тип публикации` (`Статья` или `Новость`);
   - `Обложка`;
   - `Краткое описание (Lead)`;
   - `Содержание`.
4. Нажмите `Создать черновик`.
5. В списке откройте материал для редактирования.
6. Нажмите `Отправить на проверку`.

### Если материал вернули на доработку

1. Откройте материал со статусом `needs_revision`.
2. Прочитайте комментарий главного редактора.
3. Исправьте материал.
4. Нажмите `Отправить повторно`.

## 5.2 Chief editor: проверка материала

1. Откройте `Очередь проверки` (`/cms/chief-editor`).
2. Выберите материал.
3. Проверьте заголовок, лид, содержание, обложку, структуру.
4. Выберите действие:
   - `Одобрить` (переводит материал в `approved`);
   - `Отправить на доработку` и добавьте конкретный комментарий.

Примечание: в интерфейсе может встречаться текст "Одобрить и опубликовать", но по workflow этот шаг переводит материал в состояние `approved` (не в `published`).

## 5.3 Publishing editor: публикация и снятие

1. Откройте `Центр публикации` (`/cms/publisher-editor`).
2. Выберите материал из очереди одобренных.
3. Нажмите `Опубликовать сейчас`.
4. Для отката публикации откройте материал и нажмите `Снять с публикации`.

## 5.4 Admin: пользователи и контент

1. Откройте `Панель администратора` (`/cms/admin`).
2. Вкладка `Пользователи`:
   - изменить роль пользователя;
   - активировать/деактивировать учетную запись.
3. Вкладка `Материалы`:
   - просмотреть список материалов;
   - удалить материал (действие необратимо).

---

## 6. Поля материала и требования

Минимальные требования при создании/редактировании:

- Заголовок: минимум 3 символа.
- Содержание: минимум 10 символов.
- Тип: `article` или `news`.

Рекомендуемые редакционные требования:

- заголовок четко отражает содержание;
- лид кратко передает суть материала;
- структура текста логична (абзацы, подзаголовки);
- нет орфографических и фактических ошибок;
- обложка релевантна теме.

---

## 7. Статусы материалов (справочник)

- `draft` - черновик редактора.
- `in_review` - отправлено на проверку.
- `needs_revision` - возвращено автору на доработку.
- `approved` - одобрено главным редактором, доступно publishing editor.
- `published` - опубликовано.

---

## 8. Навигация по разделам

Основные рабочие URL:

- Dashboard: `/cms/dashboard`
- Editor list: `/cms/editor`
- Editor create: `/cms/editor/create`
- Chief editor queue: `/cms/chief-editor`
- Publishing center: `/cms/publisher-editor`
- Admin panel: `/cms/admin`

Важно: часть пунктов сайдбара может быть временно не реализована как полноценные страницы (например, отдельные настройки/модерация), это нормально для текущей версии.

---

## 9. Типовые ошибки и как их решать

1. Ошибка входа (`Неверный email или пароль`):
   - проверьте email и пароль;
   - проверьте раскладку клавиатуры;
   - при необходимости выполните повторный вход.

2. Нет доступа к разделу:
   - скорее всего, текущая роль не имеет прав;
   - обратитесь к администратору для корректировки роли.

3. Аккаунт неактивен:
   - администратор должен активировать пользователя.

4. Материал не отправляется на проверку:
   - проверьте обязательные поля;
   - проверьте минимальные ограничения по длине.

5. Не отображается ожидаемый пункт меню:
   - меню зависит от роли;
   - часть разделов может быть недоступна в текущей сборке.

---

## 10. Онбординг нового сотрудника (чеклист)

1. Зарегистрировать пользователя через `/signup` (не `admin`).
2. Назначить корректную роль через админ-панель.
3. Выполнить роль-специфичный тест:
   - Editor: создать и отправить материал.
   - Chief editor: одобрить или вернуть на доработку.
   - Publishing editor: опубликовать материал.
4. Проверить, что пользователь видит только доступные ему разделы.
5. Зафиксировать прохождение онбординга во внутреннем чеклисте команды.

---

## 11. Локальный запуск для команды разработки

## 11.1 Backend

```bash
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
cp .env.example .env
alembic upgrade head
python -m app.db.init_db
uvicorn app.main:app --reload --port 8000
```

## 11.2 Frontend CMS

```bash
cd frontend
npm install
npm run dev:cms
```

После запуска CMS доступна на `http://localhost:3001`.

Тестовый админ после инициализации БД:

- Email: `admin@qazaq.kz`
- Пароль: `admin123`

Для production обязательно смените пароль администратора.

---

## 12. Операционные правила для команды

1. При возврате на доработку всегда оставляйте конкретный комментарий (что исправить и почему).
2. Не публикуйте материал без финальной проверки фактов и оформления.
3. Изменение ролей пользователей делайте только по согласованному запросу.
4. Удаление материала в админке выполняйте только при уверенности, что восстановление не потребуется.

---

## 13. Быстрый FAQ

### Кто может публиковать?

`publishing_editor` и пользователи с административным доступом к соответствующему процессу.

### Кто может назначать роли?

`admin`.

### Можно ли зарегистрировать `admin` через форму?

Нет. Эта роль не доступна в self-signup.

### Где увидеть причину возврата материала?

В карточке материала editor при статусе `needs_revision`.
